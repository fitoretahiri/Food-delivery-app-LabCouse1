{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Arber\\\\Documents\\\\GitHub\\\\Food-delivery-app-LabCouse1\\\\Food-delivery-app-LabCouse1\\\\front-end-code\\\\src\\\\LoginForm.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState, useRef } from 'react';\nimport useAuth from './hooks/useAuth';\nimport { useNavigate, useLocation, Link } from 'react-router-dom';\nimport axios, { axiosPrivate } from './api/axios';\nimport { faCheck, faTimes, faInfoCircle } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport './styles/register.css';\nimport useAxiosPrivate from \"./hooks/useAxiosPrivate\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst EMAIL_REGEX = /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/;\nconst PWD_REGEX = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%*_]).{8,24}$/;\n\nfunction LoginForm(props) {\n  _s();\n\n  var _location$state, _location$state$from;\n\n  //const axiosPrivate = useAxiosPrivate();\n  const [isLoading, setIsLoading] = useState(false);\n  const {\n    setAuth,\n    persist,\n    setPersist\n  } = useAuth();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const from = ((_location$state = location.state) === null || _location$state === void 0 ? void 0 : (_location$state$from = _location$state.from) === null || _location$state$from === void 0 ? void 0 : _location$state$from.pathname) || \"/\";\n  const userRef = useRef();\n  const errRef = useRef();\n  const [email, setEmail] = useState('');\n  const [validEmail, setValidEmail] = useState(false);\n  const [emailFocus, setEmailFocus] = useState(false);\n  const [password, setPassword] = useState('');\n  const [validPassword, setValidPassword] = useState(false);\n  const [passwordFocus, setPasswordFocus] = useState(false);\n  const [redirect, setRedirect] = useState(false);\n  const [role, setRole] = useState('');\n  const [errMsg, setErrMsg] = useState('');\n  useEffect(() => {\n    const result = EMAIL_REGEX.test(email);\n    setValidEmail(result);\n  }, [email]);\n  useEffect(() => {\n    const result = PWD_REGEX.test(password);\n    setValidPassword(result);\n  }, [password]);\n  useEffect(() => {\n    setErrMsg('');\n  }, [email, password]);\n  let validData = !validEmail || !validPassword ? true : false;\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    const data = {\n      email: email,\n      password: password\n    };\n\n    try {\n      var _response$data, _response$data2, _response$data3;\n\n      setIsLoading(true);\n      const response = await axios.post('/api/authmanagement/login', data, {\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        withCredentials: true\n      });\n      const accessToken = response === null || response === void 0 ? void 0 : (_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.token;\n      const refreshToken = response === null || response === void 0 ? void 0 : (_response$data2 = response.data) === null || _response$data2 === void 0 ? void 0 : _response$data2.refreshToken;\n      const roles = response === null || response === void 0 ? void 0 : (_response$data3 = response.data) === null || _response$data3 === void 0 ? void 0 : _response$data3.roles;\n      console.log(accessToken);\n      console.log(refreshToken);\n      setAuth({\n        email,\n        password,\n        roles,\n        accessToken\n      });\n      navigate(from, {\n        replace: true\n      });\n\n      if (from === '/') {\n        if (roles.includes('Administrator')) {\n          navigate('admin');\n        } else if (roles.includes('Restorant')) {\n          navigate('restorantidashboard');\n        } else {\n          navigate('menu');\n        }\n      }\n    } catch (err) {\n      var _err$response, _err$response2;\n\n      if (!(err !== null && err !== void 0 && err.response)) {\n        setErrMsg('Serveri nuk ktheu pergjigje!');\n      } else if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 400) {\n        setErrMsg('Te dhenat jane gabim');\n      } else if (((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : _err$response2.status) === 401) {\n        setErrMsg('Unauthorized');\n      } else {\n        setErrMsg('Kyqja ne sistem Deshtoi');\n      }\n\n      setIsLoading(false);\n    }\n  };\n\n  const togglePersist = () => {\n    setPersist(prev => !prev);\n  };\n\n  useEffect(() => {\n    localStorage.setItem(\"persist\", persist);\n  }, [persist]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"d-flex justify-content-center\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        class: \"spinner-border text-primary\",\n        role: \"status\",\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          class: \"visually-hidden\",\n          children: \"Loading...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 3\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 7\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 5\n    }, this)\n  }, void 0, false);\n}\n\n_s(LoginForm, \"Au368e65XgTN1ccH9QPNaCTp2pQ=\", false, function () {\n  return [useAuth, useNavigate, useLocation];\n});\n\n_c = LoginForm;\nexport default LoginForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"LoginForm\");","map":{"version":3,"names":["React","useEffect","useState","useRef","useAuth","useNavigate","useLocation","Link","axios","axiosPrivate","faCheck","faTimes","faInfoCircle","FontAwesomeIcon","useAxiosPrivate","EMAIL_REGEX","PWD_REGEX","LoginForm","props","isLoading","setIsLoading","setAuth","persist","setPersist","navigate","location","from","state","pathname","userRef","errRef","email","setEmail","validEmail","setValidEmail","emailFocus","setEmailFocus","password","setPassword","validPassword","setValidPassword","passwordFocus","setPasswordFocus","redirect","setRedirect","role","setRole","errMsg","setErrMsg","result","test","validData","handleSubmit","e","preventDefault","data","response","post","headers","withCredentials","accessToken","token","refreshToken","roles","console","log","replace","includes","err","status","togglePersist","prev","localStorage","setItem"],"sources":["C:/Users/Arber/Documents/GitHub/Food-delivery-app-LabCouse1/Food-delivery-app-LabCouse1/front-end-code/src/LoginForm.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\r\nimport useAuth from './hooks/useAuth';\r\n\r\nimport { useNavigate, useLocation, Link } from 'react-router-dom';\r\nimport axios, { axiosPrivate } from './api/axios';\r\nimport { faCheck, faTimes, faInfoCircle } from \"@fortawesome/free-solid-svg-icons\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\r\nimport './styles/register.css'\r\nimport useAxiosPrivate from \"./hooks/useAxiosPrivate\";\r\n\r\nconst EMAIL_REGEX = /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/;\r\nconst PWD_REGEX = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%*_]).{8,24}$/;\r\n\r\nfunction LoginForm(props) {\r\n  //const axiosPrivate = useAxiosPrivate();\r\n\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  const { setAuth, persist, setPersist } = useAuth();\r\n\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const from = location.state?.from?.pathname || \"/\";\r\n\r\n  const userRef = useRef();\r\n  const errRef = useRef();\r\n\r\n  const [email, setEmail] = useState('')\r\n  const [validEmail, setValidEmail] = useState(false);\r\n  const [emailFocus, setEmailFocus] = useState(false);\r\n\r\n  const [password, setPassword] = useState('')\r\n  const [validPassword, setValidPassword] = useState(false);\r\n  const [passwordFocus, setPasswordFocus] = useState(false);\r\n\r\n\r\n  const [redirect, setRedirect] = useState(false)\r\n  const [role, setRole] = useState('')\r\n\r\n  const [errMsg, setErrMsg] = useState('');\r\n\r\n\r\n  useEffect(() => {\r\n    const result = EMAIL_REGEX.test(email);\r\n    setValidEmail(result);\r\n  }, [email])\r\n\r\n  useEffect(() => {\r\n    const result = PWD_REGEX.test(password);\r\n    setValidPassword(result);\r\n  }, [password])\r\n\r\n  useEffect(() => {\r\n    setErrMsg('');\r\n  }, [email, password])\r\n\r\n  let validData = !validEmail || !validPassword ? true : false;\r\n\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    const data = {\r\n      email: email,\r\n      password: password\r\n    }\r\n\r\n    try {\r\n      setIsLoading(true);\r\n      const response = await axios.post('/api/authmanagement/login',\r\n        data,\r\n        {\r\n          headers: { 'Content-Type': 'application/json' },\r\n          withCredentials: true\r\n        }\r\n      );\r\n\r\n      const accessToken = response?.data?.token;\r\n      const refreshToken = response?.data?.refreshToken;\r\n      const roles = response?.data?.roles\r\n\r\n      console.log(accessToken);\r\n      console.log(refreshToken);\r\n\r\n      setAuth({ email, password, roles, accessToken });\r\n      navigate(from, { replace: true });\r\n      if (from === '/') {\r\n        if (roles.includes('Administrator')) {\r\n          navigate('admin');\r\n        } else if (roles.includes('Restorant')) {\r\n          navigate('restorantidashboard');\r\n        } else {\r\n          navigate('menu');\r\n        }\r\n      }\r\n    } catch (err) {\r\n      if (!err?.response) {\r\n        setErrMsg('Serveri nuk ktheu pergjigje!');\r\n      } else if (err.response?.status === 400) {\r\n        setErrMsg('Te dhenat jane gabim');\r\n      } else if (err.response?.status === 401) {\r\n        setErrMsg('Unauthorized');\r\n      } else {\r\n        setErrMsg('Kyqja ne sistem Deshtoi');\r\n      }\r\n      setIsLoading(false);\r\n    }\r\n  }\r\n\r\n  const togglePersist = () => {\r\n    setPersist(prev => !prev)\r\n  }\r\n\r\n  useEffect(() => {\r\n    localStorage.setItem(\"persist\", persist);\r\n  }, [persist])\r\n\r\n  return (\r\n    <>\r\n    <div className=\"d-flex justify-content-center\">\r\n      <div class=\"spinner-border text-primary\" role=\"status\">\r\n  <span class=\"visually-hidden\">Loading...</span>\r\n</div>\r\n      {\r\n        \r\n      }\r\n    </div>\r\n    </>\r\n  )\r\n\r\n}\r\n\r\nexport default LoginForm;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}